# システム設計書：Googleカレンダー日報自動Slack投稿システム

## 1. 全体構成

本システムは、Googleカレンダーから予定情報を取得し、日報を自動生成してSlackチャンネルへ投稿する。AWS Lambda上で動作し、EventBridgeによるスケジュール実行に対応する。

### 構成図（テキスト）

- AWS EventBridge（スケジューラ）
    ↓
- AWS Lambda（Python実装）
    ├─ GoogleカレンダーAPI連携
    ├─ 日報生成（テンプレートエンジン）
    └─ Slack API連携

## 2. モジュール設計

### 2.1. GoogleカレンダーAPI連携モジュール
- OAuth2.0認証（初回のみ手動認証、以降はトークン管理）
- 指定日付の予定一覧取得
- 予定詳細（タイトル、色、開始・終了時刻、説明文）抽出

### 2.2. 日報生成モジュール
- テンプレート（Slack投稿用）に予定情報を埋め込み日報を生成
- 各予定の所要時間を自動計算
- 未記録時間帯の検出

### 2.3. Slack API連携モジュール
- 指定チャンネルへの日報投稿
- 未記録時間帯がある場合はユーザーDMで確認・追記依頼
- 投稿前プレビュー（オプション）

### 2.4. Lambdaハンドラ
- EventBridgeからのトリガーで自動実行
- コマンドライン引数相当のパラメータ（環境変数/イベント引数）受け取り
- エラーハンドリング（API認証失敗、ネットワークエラー、Slack投稿失敗等）

## 3. データ設計

- Googleカレンダー予定情報：
    - id, summary, colorId, start, end, description
- 日報生成用データ：
    - 日付, 予定リスト（タイトル、時間、説明、所要時間）
- Slack投稿用データ：
    - 投稿先チャンネルID, 投稿本文, ユーザーID（DM用）

## 4. テンプレート設計

- Slack投稿用テンプレート例：
    - 日付
    - 各予定（タイトル・時間・説明・所要時間）
    - 未記録時間帯の有無

## 5. セキュリティ・運用設計

- 認証情報はAWS Secrets Managerや環境変数で安全に管理
- LambdaのIAM権限は最小限に
- ログはCloudWatchに出力し、障害時のトレースを容易に

## 6. 拡張性・今後の展望

- テンプレートカスタマイズ機能
- 複数出力先（メール、Teams等）対応
- Slackワークフロー連携
- 複数ユーザー・複数チャンネル対応
- 柔軟なスケジュール設定
- 予定フィルタリング機能

---

（詳細なクラス設計やAPI仕様は今後の開発フェーズで追記）
